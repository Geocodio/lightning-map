!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("LightningMap",[],e):"object"==typeof exports?exports.LightningMap=e():t.LightningMap=e()}(window,function(){return function(t){var e={};function o(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,o),n.l=!0,n.exports}return o.m=t,o.c=e,o.d=function(t,e,i){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)o.d(i,n,function(e){return t[e]}.bind(null,n));return i},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=1)}([function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.defaultMarkerOptions=e.defaultMapOptions=void 0;e.defaultMapOptions={source:function(t,e,o){return"https://maps.geocod.io/tiles/base/".concat(o,"/").concat(t,"/").concat(e,".png")},zoom:12,center:[38.841779,-77.088312],tileSize:256,panAccelerationMultiplier:2,maxPanAcceleration:3.5,throwTimingThresholdMs:100,throwVelocityThreshold:3e3,animationDurationMs:500,debounceIntervalMs:200,tileAreaMultiplier:2,tileZoomMultiplier:4,debug:!1};e.defaultMarkerOptions={color:"rgba(0, 0, 200, 0.7)",type:"marker"}},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=s(o(2)),n=s(o(5));function s(t){return t&&t.__esModule?t:{default:t}}var a={Map:i.default,Marker:n.default};e.default=a,t.exports=e.default},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=a(o(3)),n=a(o(4)),s=o(0);function a(t){return t&&t.__esModule?t:{default:t}}function r(t,e){for(var o=0;o<e.length;o++){var i=e[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var l=function(){function t(e,o){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),!e||!e.getContext)throw new Error("Could not get canvas context");this.canvas=e,this.context=this.canvas.getContext("2d"),this.options=Object.assign({},s.defaultMapOptions,o),this.initializeState(),this.attachEvents(),this.applyStyles(),this.lastDrawState=null,this.draw=this.draw.bind(this),window.requestAnimationFrame(this.draw)}return function(t,e,o){e&&r(t.prototype,e),o&&r(t,o)}(t,[{key:"initializeState",value:function(){this.state={canvasDimensions:[this.canvas.width,this.canvas.height],tiles:{},grid:[],gridHash:null,relativeTileOffset:[0,0],moveOffset:[0,0],targetMoveOffset:[0,0],targetMoveOffsetIsCoord:!1,moveAnimationStart:null,dragStartPosition:null,lastEventActionTime:null,startZoom:this.options.zoom,targetZoom:this.options.zoom,zoomAnimationStart:null,scale:1,lastMouseMoveEvent:null,mouseVelocities:[],markers:[]}}},{key:"getZoom",value:function(){return this.options.zoom}},{key:"setZoom",value:function(t){this.zoomValueIsValid(t)&&(this.state.lastEventActionTime=window.performance.now(),this.state.zoomAnimationStart=window.performance.now(),this.state.targetZoom=t,this.state.startZoom=this.options.zoom)}},{key:"setCenter",value:function(t){if(!Array.isArray(t)||2!==t.length)throw new Error("Please provide a valid array with a lat/lon");t=t.map(function(t){return parseFloat(t)}),this.state.moveAnimationStart=window.performance.now(),this.state.targetMoveOffset=t,this.state.targetMoveOffsetIsCoord=!0}},{key:"setTargetMoveOffset",value:function(t,e){!(arguments.length>2&&void 0!==arguments[2])||arguments[2]?(this.state.moveAnimationStart=window.performance.now(),this.state.targetMoveOffset=i.default.pixelToLatLon([t,e],this.options.center,this.options.zoom,this.options.tileSize),this.state.targetMoveOffsetIsCoord=!0):(this.state.targetMoveOffset=[t,e],this.state.targetMoveOffsetIsCoord=!1,this.state.moveOffset=this.state.targetMoveOffset)}},{key:"zoomValueIsValid",value:function(t){return t>=1&&t<=18}},{key:"isReadyForEvent",value:function(){return!this.state.lastEventActionTime||window.performance.now()-this.state.lastEventActionTime>this.options.debounceIntervalMs}},{key:"calculateVelocity",value:function(t,e,o,i){return(t-e)/(o-i)*1e3}},{key:"attachEvents",value:function(){var t=this;this.canvas.addEventListener("wheel",function(e){e.preventDefault(),t.isReadyForEvent()&&(e.deltaY>5?t.setZoom(t.options.zoom-1):e.deltaY<-5&&t.setZoom(t.options.zoom+1))}),this.canvas.addEventListener("dblclick",function(e){e.preventDefault();var o=t.state.canvasDimensions[0]/2,i=t.state.canvasDimensions[1]/2;t.setTargetMoveOffset(-(e.clientX-o),-(e.clientY-i)),t.setZoom(t.options.zoom+1)}),this.canvas.addEventListener("mousedown",function(e){e.preventDefault(),t.state.mouseVelocities=[],t.state.dragStartPosition=[e.clientX-t.state.moveOffset[0],e.clientY-t.state.moveOffset[1]]}),this.canvas.addEventListener("mouseup",function(e){e.preventDefault();var o=-(t.state.dragStartPosition[0]-e.clientX),i=-(t.state.dragStartPosition[1]-e.clientY);if(0!==t.state.moveOffset[0]||0!==t.state.moveOffset[1]){var n=window.performance.now()-t.options.throwTimingThresholdMs,s=t.state.mouseVelocities.filter(function(t){return t[0]>n}).map(function(t){return t[1]}),a=s.reduce(function(t,e){return t+e},0)/s.length;if(a>=t.options.throwVelocityThreshold){var r=a/t.options.throwVelocityThreshold*t.options.panAccelerationMultiplier;r=Math.min(r,t.options.maxPanAcceleration),t.setTargetMoveOffset(o*r,i*r)}else t.updateCenter()}t.state.dragStartPosition=null}),this.canvas.addEventListener("mousemove",function(e){if(e.preventDefault(),t.state.dragStartPosition){var o=-(t.state.dragStartPosition[0]-e.clientX),i=-(t.state.dragStartPosition[1]-e.clientY),n=window.performance.now(),s=t.calculateVelocity(t.state.moveOffset[0],o,n,t.state.lastMouseMoveEvent),a=t.calculateVelocity(t.state.moveOffset[1],i,n,t.state.lastMouseMoveEvent),r=Math.round(Math.sqrt(s*s+a*a));t.state.mouseVelocities.push([n,r]),t.setTargetMoveOffset(o,i,!1),t.state.lastMouseMoveEvent=window.performance.now()}return!1})}},{key:"applyStyles",value:function(){this.canvas.style.cursor="grab"}},{key:"getTilesCount",value:function(t){var e=Math.ceil(t/this.options.tileSize)*this.options.tileAreaMultiplier;return e%2==0&&e++,e}},{key:"easeOutQuad",value:function(t){return t*(2-t)}},{key:"updateMoveOffset",value:function(){if(Object.values(this.state.moveOffset).join(",")!==Object.values(this.state.targetMoveOffset).join(",")){var t=window.performance.now(),e=Math.max(t-this.state.moveAnimationStart,0),o=this.easeOutQuad(e/this.options.animationDurationMs),n=this.state.targetMoveOffset;this.state.targetMoveOffsetIsCoord&&(n=i.default.latLonToPixel(this.state.targetMoveOffset,this.options.center,this.options.zoom,this.options.tileSize,this.state.canvasDimensions)),this.state.moveOffset=o>=.99?n:[this.state.moveOffset[0]+(n[0]-this.state.moveOffset[0])*o,this.state.moveOffset[1]+(n[1]-this.state.moveOffset[1])*o],Object.values(this.state.moveOffset).join(",")===Object.values(n).join(",")&&this.updateCenter()}}},{key:"updateCenter",value:function(){var t=i.default.pixelToLatLon(this.state.moveOffset,this.options.center,this.options.zoom,this.options.tileSize);this.setTargetMoveOffset(0,0,!1),this.options.center=t}},{key:"updateZoom",value:function(){if(this.options.zoom!==this.state.targetZoom){var t=Math.max(window.performance.now()-this.state.zoomAnimationStart,0),e=this.easeOutQuad(t/this.options.animationDurationMs),o=Math.abs(this.state.targetZoom-this.state.startZoom)*e,i=e>=.99?this.state.targetZoom:this.state.startZoom+o;this.options.zoom=i;var n=Math.round(this.options.zoom),s=this.options.zoom-n;this.state.scale=Math.pow(2,s)}else this.state.scale=1}},{key:"calculateGrid",value:function(){var t=i.default.lat2tile(this.options.center[0],Math.round(this.options.zoom),!1),e=i.default.lon2tile(this.options.center[1],Math.round(this.options.zoom),!1),o=[t,e].join(",");if(this.state.gridHash!==o){var s=this.getTilesCount(this.state.canvasDimensions[0]),a=this.getTilesCount(this.state.canvasDimensions[1]),r=Math.floor(t),l=Math.floor(e);this.state.relativeTileOffset=[Math.abs(e-l),Math.abs(t-r)];for(var u=l-Math.floor(s/2),c=r-Math.floor(a/2),f=[],h=0;h<a;h++)for(var v=0;v<s;v++){f[v]||(f[v]=[]);var d=u+v,p=c+h;if(d>=0&&p>=0){var m=new n.default(d,p,Math.round(this.options.zoom));this.ensureTileAsset(m),f[v][h]=m}}this.state.grid=f,this.state.gridHash=o}}},{key:"ensureTileAsset",value:function(t){var e=this;!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t.id in this.state.tiles||(this.state.tiles[t.id]=new Image,this.state.tiles[t.id].tileId=t.id,this.state.tiles[t.id].src=this.options.source(Math.floor(t.x),Math.floor(t.y),t.zoom),this.state.tiles[t.id].loaded=!1,this.state.tiles[t.id].onload=function(){e.state.tiles[t.id].loaded=!0}),this.state.tiles[t.id].lastRequested=(new Date).getTime()}},{key:"garbageCollect",value:function(){var t=this,e=Object.values(this.state.tiles);if(e.length>this.maxTilesToKeep()){var o=(new Date).getTime()-5e3,i=e.filter(function(t){return t.lastRequested<o}).sort(function(t,e){return~~(t.lastRequested<e.lastRequested)}),n=this.maxTilesToKeep()-(e.length-i.length);i.splice(i.length-n).forEach(function(e){e.src="",delete t.state.tiles[e.tileId]})}}},{key:"maxTilesToKeep",value:function(){return 1e3}},{key:"shouldRedraw",value:function(){var t=JSON.stringify([this.state,this.options]);return this.lastDrawState!==t&&(this.lastDrawState=t,!0)}},{key:"draw",value:function(){this.updateMoveOffset(),this.updateZoom(),this.calculateGrid(),this.garbageCollect(),this.shouldRedraw()&&(this.drawTiles(),this.drawMarkers()),window.requestAnimationFrame(this.draw)}},{key:"drawTiles",value:function(){var t=this.state.canvasDimensions[0],e=this.state.canvasDimensions[1],o=this.options.tileSize*this.state.scale,i=[o/2-this.state.relativeTileOffset[0]*o,o/2-this.state.relativeTileOffset[1]*o];this.context.fillStyle="#EEE",this.context.fillRect(0,0,t,e);for(var n=this.getTilesCount(t),s=this.getTilesCount(e),a=n*o-t,r=s*o-e,l=0;l<s;l++)for(var u=0;u<n;u++){var c=this.state.grid[u][l];if(c){var f=this.state.moveOffset[0]+i[0]+(u*o-a/2),h=this.state.moveOffset[1]+i[1]+(l*o-r/2);try{this.state.tiles[c.id].loaded?this.context.drawImage(this.state.tiles[c.id],f,h,o,o):this.drawGenericBackground(f,h,o)}catch(t){this.drawGenericBackground(f,h,o)}this.options.debug&&(this.context.strokeStyle="green",this.context.strokeRect(f,h,o,o))}}this.options.debug&&(this.context.fillStyle="rgba(200, 0, 0, 0.7)",this.context.beginPath(),this.context.arc(t/2,e/2,5,0,2*Math.PI),this.context.fill())}},{key:"drawGenericBackground",value:function(t,e,o){var i=o/8;this.context.beginPath();for(var n=i;n<o;n+=i)for(var s=i;s<o;s+=i)this.context.moveTo(t,e+s),this.context.lineTo(t+o,e+s),this.context.moveTo(t+n,e),this.context.lineTo(t+n,e+o);this.context.strokeStyle="#DDD",this.context.stroke(),this.context.strokeStyle="#CCC",this.context.strokeRect(t,e,o,o)}},{key:"getMapBounds",value:function(){return{nw:i.default.pixelToLatLon([this.state.canvasDimensions[0]/2,this.state.canvasDimensions[1]/2],this.options.center,this.options.zoom,this.options.tileSize),se:i.default.pixelToLatLon([-this.state.canvasDimensions[0]/2,-this.state.canvasDimensions[1]/2],this.options.center,this.options.zoom,this.options.tileSize)}}},{key:"drawMarkers",value:function(){var t=this,e=this.getMapBounds(),o=this.state.markers.filter(function(t){return t.coords[0]<=e.nw[0]&&t.coords[0]>=e.se[0]&&t.coords[1]>=e.nw[1]&&t.coords[1]<=e.se[1]}),n=[this.state.canvasDimensions[0]/2,this.state.canvasDimensions[1]/2];o.map(function(e){var o=i.default.latLonToPixel(e.coords,t.options.center,t.options.zoom,t.options.tileSize,t.state.canvasDimensions);e.render(t.context,[n[0]-o[0]+t.state.moveOffset[0],n[1]-o[1]+t.state.moveOffset[1]])})}},{key:"addMarker",value:function(t){this.state.markers.push(t)}}]),t}();e.default=l,t.exports=e.default},function(t,e,o){"use strict";function i(t,e){for(var o=0;o<e.length;o++){var i=e[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return function(t,e,o){e&&i(t.prototype,e),o&&i(t,o)}(t,null,[{key:"lon2tile",value:function(t,e){var o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=(t+180)/360*Math.pow(2,e);return o?Math.floor(i):i}},{key:"lat2tile",value:function(t,e){var o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=(1-Math.log(Math.tan(t*Math.PI/180)+1/Math.cos(t*Math.PI/180))/Math.PI)/2*Math.pow(2,e);return o?Math.floor(i):i}},{key:"tile2lon",value:function(t,e){return t/Math.pow(2,e)*360-180}},{key:"tile2lat",value:function(t,e){var o=Math.PI-2*Math.PI*t/Math.pow(2,e);return 180/Math.PI*Math.atan(.5*(Math.exp(o)-Math.exp(-o)))}},{key:"tile2boundingBox",value:function(e,o,i){return{ne:[t.tile2lat(o,i),t.tile2lon(e+1,i)],sw:[t.tile2lat(o+1,i),t.tile2lon(e,i)]}}},{key:"pixelToLatLon",value:function(e,o,i,n){var s=[e[0]/n,e[1]/n],a=t.lon2tile(o[1],i,!1)-s[0],r=t.lat2tile(o[0],i,!1)-s[1];return[t.tile2lat(r,i),t.tile2lon(a,i)]}},{key:"latLonToPixel",value:function(e,o,i,n,s){var a=t.lon2tile(e[1],i,!1),r=t.lat2tile(e[0],i,!1);return[-(a-t.lon2tile(o[1],i,!1))*n,-(r-t.lat2tile(o[0],i,!1))*n]}}]),t}();e.default=n,t.exports=e.default},function(t,e,o){"use strict";function i(t,e){for(var o=0;o<e.length;o++){var i=e[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=function(){function t(e,o,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._x=e,this._y=o,this._zoom=i}return function(t,e,o){e&&i(t.prototype,e),o&&i(t,o)}(t,[{key:"x",get:function(){return this._x}},{key:"y",get:function(){return this._y}},{key:"zoom",get:function(){return this._zoom}},{key:"id",get:function(){return[this.x,this.y,this.zoom].join("|")}}]),t}();e.default=n,t.exports=e.default},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=o(0);function n(t,e){for(var o=0;o<e.length;o++){var i=e[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var s=function(){function t(e){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._coords=e,this._options=Object.assign({},i.defaultMarkerOptions,o)}return function(t,e,o){e&&n(t.prototype,e),o&&n(t,o)}(t,[{key:"render",value:function(t,e){var o=null;switch(this.options.type){case"marker":o=this.renderMarker;break;case"circle":o=this.renderCircle;break;case"donut":o=this.renderDonut}if(!o)throw new Error('Unsupported marker type: "'.concat(this.options.type,'"'));t.fillStyle=this.options.color,t.strokeStyle=this.options.color,(o=o.bind(this))(t,e)}},{key:"renderCircle",value:function(t,e){t.save(),t.beginPath(),t.arc(e[0],e[1],5,0,2*Math.PI),t.fill(),t.restore()}},{key:"renderDonut",value:function(t,e){t.save(),t.beginPath(),t.lineWidth=5,t.arc(e[0],e[1],7,0,2*Math.PI),t.stroke(),t.restore()}},{key:"renderMarker",value:function(t,e){var o=e[0]-8.8490345,i=e[1]-24.786272;t.save(),t.transform(.184386,0,0,.184386,.551658+o,4.09576+i),t.beginPath(),t.lineWidth=1.667195,t.moveTo(45,-22.212949),t.bezierCurveTo(18.494941,-22.212949,-2.991863,-.726145,-2.991863,25.778914),t.bezierCurveTo(-2.991863,52.282306,45,112.21295,45,112.21295),t.bezierCurveTo(45,112.21295,92.991863,52.282306,92.991863,25.777247),t.bezierCurveTo(92.991863,-.726145,71.505059,-22.212949,45,-22.212949),t.moveTo(45,43.827962),t.bezierCurveTo(33.553042,43.827962,24.273437,34.550024,24.273437,23.103067),t.bezierCurveTo(24.273437,11.656109,33.553042,2.376504,45,2.376504),t.bezierCurveTo(56.446958,2.376504,65.726563,11.654442,65.726563,23.101399),t.bezierCurveTo(65.726563,34.548357,56.446958,43.827962,45,43.827962),t.fill(),t.restore()}},{key:"coords",get:function(){return this._coords}},{key:"options",get:function(){return this._options}}]),t}();e.default=s,t.exports=e.default}])});
//# sourceMappingURL=LightningMap.min.js.map