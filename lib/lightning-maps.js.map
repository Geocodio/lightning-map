{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/Lightning.js","webpack:///./src/Tile.js","webpack:///./src/TileConversion.js","webpack:///./src/index.js"],"names":["Lightning","canvas","getContext","Error","draw","bind","context","canvasDimensions","width","height","tiles","tileDimensions","debug","window","requestAnimationFrame","zoom","coord","center","source","horizontalTiles","Math","ceil","verticalTiles","getHorizontalTiles","getVerticalTiles","centerY","lat2tile","centerX","lon2tile","startX","floor","startY","grid","y","x","calculateGrid","globalCompositeOperation","clearRect","strokeStyle","horizontalOverflow","verticalOverflow","tile","id","Image","src","drawImage","strokeRect","Tile","_x","_y","_zoom","join","TileConversion","lon","pow","lat","log","tan","PI","cos","z","n","atan","exp"],"mappings":"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","file":"lightning-maps.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/index.js\");\n","import TileConversion from './TileConversion';\nimport Tile from './Tile';\n\nexport default class Lightning {\n  constructor(canvas) {\n    if (!canvas || !canvas.getContext) {\n      throw new Error('Could not get canvas context');\n    }\n\n    this.draw = this.draw.bind(this);\n\n    this.context = canvas.getContext('2d');\n    this.canvasDimensions = [canvas.width, canvas.height];\n    this.tiles = {};\n    this.tileDimensions = [256, 256];\n\n    this.debug = false;\n\n    window.requestAnimationFrame(this.draw);\n  }\n\n  setZoom(zoom) {\n    this.zoom = zoom;\n    return this;\n  }\n\n  setCenter(coord) {\n    this.center = coord;\n    return this;\n  }\n\n  setSource(source) {\n    this.source = source;\n    return this;\n  }\n\n  getHorizontalTiles() {\n    let horizontalTiles = Math.ceil(this.canvasDimensions[0] / this.tileDimensions[0]);\n    if (horizontalTiles % 2 === 0) {\n      horizontalTiles++;\n    }\n\n    return horizontalTiles;\n  }\n\n  getVerticalTiles() {\n    let verticalTiles = Math.ceil(this.canvasDimensions[1] / this.tileDimensions[1]);\n    if (verticalTiles % 2 === 0) {\n      verticalTiles++;\n    }\n\n    return verticalTiles;\n  }\n\n  calculateGrid() {\n    const horizontalTiles = this.getHorizontalTiles();\n    const verticalTiles = this.getVerticalTiles();\n\n    const centerY = TileConversion.lat2tile(this.center[0], this.zoom);\n    const centerX = TileConversion.lon2tile(this.center[1], this.zoom);\n\n    const startX = centerX - Math.floor(horizontalTiles / 2);\n    const startY = centerY - Math.floor(verticalTiles / 2);\n\n    let grid = [];\n\n    for (let y = 0; y < verticalTiles; y++) {\n      for (let x = 0; x < horizontalTiles; x++) {\n        if (!grid[x]) {\n          grid[x] = [];\n        }\n\n        grid[x][y] = new Tile(startX + x, startY + y, this.zoom);\n      }\n    }\n\n    this.grid = grid;\n  }\n\n  draw() {\n    this.calculateGrid();\n\n    this.context.globalCompositeOperation = 'destination-over';\n    this.context.clearRect(0, 0, this.canvasDimensions[0], this.canvasDimensions[1]);\n    this.context.strokeStyle = 'green';\n    //this.context.fillStyle = '#eeeeee';\n    //this.context.fillRect(0, 0, this.canvasDimensions[0], this.canvasDimensions[1]);\n\n    const horizontalTiles = this.getHorizontalTiles();\n    const verticalTiles = this.getVerticalTiles();\n\n    const horizontalOverflow = (horizontalTiles * this.tileDimensions[0]) - this.canvasDimensions[0];\n    const verticalOverflow = (verticalTiles * this.tileDimensions[1]) - this.canvasDimensions[1];\n\n    for (let y = 0; y < verticalTiles; y++) {\n      for (let x = 0; x < horizontalTiles; x++) {\n        const tile = this.grid[x][y];\n\n        if (!(tile.id in this.tiles)) {\n          this.tiles[tile.id] = new Image();\n          this.tiles[tile.id].src = this.source(tile.x, tile.y, tile.zoom);\n        }\n\n        this.context.drawImage(\n          this.tiles[tile.id],\n          x * this.tileDimensions[0] - horizontalOverflow / 2,\n          y * this.tileDimensions[1] - verticalOverflow / 2,\n          this.tileDimensions[0],\n          this.tileDimensions[1]\n        );\n\n        if (this.debug) {\n          this.context.strokeRect(\n            x * this.tileDimensions[0] - horizontalOverflow / 2,\n            y * this.tileDimensions[1] - verticalOverflow / 2,\n            this.tileDimensions[0],\n            this.tileDimensions[1]\n          );\n        }\n      }\n    }\n\n    /*\n    this.context.fillStyle = 'rgba(0, 0, 0, 0.4)';\n    this.context.strokeStyle = 'rgba(0, 153, 255, 0.4)';\n    this.context.save();\n    this.context.translate(150, 150);\n\n    // Earth\n    const time = new Date();\n\n    this.context.rotate(((2 * Math.PI) / 60) * time.getSeconds() + ((2 * Math.PI) / 60000) * time.getMilliseconds());\n    this.context.translate(105, 0);\n    this.context.fillRect(0, -12, 50, 24); // Shadow\n    this.context.drawImage(this.earth, -12, -12);\n\n    // Moon\n    this.context.save();\n    this.context.rotate(((2 * Math.PI) / 6) * time.getSeconds() + ((2 * Math.PI) / 6000) * time.getMilliseconds());\n    this.context.translate(0, 28.5);\n    this.context.drawImage(this.moon, -3.5, -3.5);\n    this.context.restore();\n\n    this.context.restore();\n\n    this.context.beginPath();\n    this.context.arc(150, 150, 105, 0, Math.PI * 2, false); // Earth orbit\n    this.context.stroke();\n\n    this.context.drawImage(this.sun, 0, 0, 300, 300);\n    */\n\n    window.requestAnimationFrame(this.draw);\n  }\n\n}\n","export default class Tile {\n  constructor(x, y, zoom) {\n    this._x = x;\n    this._y = y;\n    this._zoom = zoom;\n  }\n\n  get x() {\n    return this._x;\n  }\n\n  get y() {\n    return this._y;\n  }\n\n  get zoom() {\n    return this._zoom;\n  }\n\n  get id() {\n    return [this.x, this.y, this.zoom].join('|');\n  }\n}\n","// Based on https://wiki.openstreetmap.org/wiki/Slippy_map_tilenames#ECMAScript_.28JavaScript.2FActionScript.2C_etc..29\nexport default class TileConversion {\n  static lon2tile(lon, zoom) {\n    return Math.floor((lon + 180) / 360 * Math.pow(2, zoom));\n  }\n\n  static lat2tile(lat, zoom) {\n    return Math.floor((1 - Math.log(Math.tan(lat * Math.PI / 180) + 1/Math.cos(lat * Math.PI / 180)) / Math.PI) / 2 * Math.pow(2, zoom));\n  }\n\n  static tile2lon(x, z) {\n    return x / Math.pow(2, z) * 360 - 180;\n  }\n\n  static tile2lat(y, z) {\n    const n = Math.PI - 2 * Math.PI * y / Math.pow(2, z);\n    return 180 / Math.PI * Math.atan(0.5 * (Math.exp(n) - Math.exp(-n)));\n  }\n}\n","import Lightning from './Lightning';\nexport { Lightning };\n"],"sourceRoot":""}